# [Usage]
#   Invoke evryfs/notify-slack-action to test the final result of its features.
#   Use the trigerred event's ref as a version of notify-slack-action.
#   This allow the following workflow to test current changes
name: Test Bot features
on:
  push:
    branches:
      - master
      - develop
  pull_request:
    branches:
      - master
      - develop
  workflow_dispatch:
env:
  SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
  CHANNEL_ID: C04DXC2LB35
jobs:
  notify-slack-blocks-templates:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout to triggered event's ref
        uses: actions/checkout@v3
      - name: Notify Slack with templates
        uses: ./
        env:
          TEXT_MESSAGE: "Tests on features are successful :rocket:"
          ACTION_STATUS: ":thumbsup:"
          VERSION_TAG: ${{ github.sha }}
        with:
          channel-id: ${{ env.CHANNEL_ID }}
          mechanism: templates
          value: gh_dashboard_simple.json
  notify-slack-blocks:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout to triggered event's ref
        uses: actions/checkout@v3
        with:
          ref: develop
      - name: Notify Slack with blocks
        uses: ./
        with:
          channel-id: ${{ env.CHANNEL_ID }}
          mechanism: blocks
          value: |
            [
              {
                "type": "section",
                "text": {
                  "type": "mrkdwn",
                  "text": "*#${{ github.run_id }} Anything humans can do in space, robots can do better.*"
                }
              },
              {
                "type": "actions",
                "elements": [
                  {
                    "type": "button",
                    "text": {
                      "type": "plain_text",
                      "emoji": true,
                      "text": "Approve"
                    },
                    "style": "primary",
                    "value": "yes"
                  },
                  {
                    "type": "button",
                    "text": {
                      "type": "plain_text",
                      "emoji": true,
                      "text": "Deny"
                    },
                    "style": "danger",
                    "value": "no"
                  }
                ]
              }
            ]
  notify-slack-text:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout to triggered event's ref
        uses: actions/checkout@v3
        with:
          ref: develop
      - name: Notify Slack with text
        uses: ./
        with:
          channel-id: ${{ env.CHANNEL_ID }}
          mechanism: text
          value: "Hello GHA from commit ${{ github.sha }}"